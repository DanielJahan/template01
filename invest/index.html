<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Invest • Million Star Resort</title>
  
  <!-- Self‑contained, cross‑OS styles (Windows, macOS, Android, iOS, Linux).
       Uses system fonts and pure CSS; no external dependencies. -->
  <style>
    :root{
      --bg: #0b132b;
      --panel: #111a33;
      --muted: #9fb3c8;
      --text: #f7f9fc;
      --primary: #4dabf7;
      --primary-contrast:#081120;
      --success:#2f9e44;
      --warning:#f59f00;
      --danger:#e03131;
      --focus:#94d2ff;
      --radius:16px;
      --shadow: 0 8px 24px rgba(0,0,0,.35);
    }
    html,body{height:100%}
    body{
      margin:0; background:linear-gradient(180deg, #070b1a 0%, #0b1633 100%);
      color:var(--text); font:16px/1.5 -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Ubuntu,"Helvetica Neue",Arial,"Apple Color Emoji","Segoe UI Emoji";
      -webkit-font-smoothing:antialiased; text-rendering:optimizeLegibility;
    }
    .container{ max-width:960px; margin:0 auto; padding:24px; }
    .topbar{ display:flex; align-items:center; justify-content:space-between; gap:16px; margin-bottom:16px; }
    .brand{ display:flex; align-items:center; gap:10px; text-decoration:none; color:var(--text); font-weight:700; letter-spacing:.4px; }
    .brand .dot{ width:10px; height:10px; border-radius:50%; background:var(--primary); box-shadow:0 0 16px var(--primary); }
    .toplinks a{ color:var(--muted); text-decoration:none; }
    .toplinks a:hover{ color:var(--text); }

    .card{ background:rgba(255,255,255,0.04); border:1px solid rgba(255,255,255,0.06); border-radius:var(--radius); box-shadow:var(--shadow); overflow:hidden; }
    .card-header{ padding:20px 20px 0 20px; }
    .card-body{ padding:20px; }

    /* Stepper */
    .stepper{ display:grid; grid-template-columns:repeat(4,1fr); gap:8px; align-items:center; padding:16px 20px; }
    .step{
      position:relative; display:flex; flex-direction:column; align-items:center; gap:8px;
    }
    .step .circle{ width:32px; height:32px; display:grid; place-items:center; border-radius:50%; background:#0e1a3d; color:var(--muted); border:1px solid rgba(255,255,255,0.1); }
    .step .label{ font-size:12px; color:var(--muted); text-align:center; }
    .step.active .circle{ background:var(--primary); color:var(--primary-contrast); border-color:transparent; }
    .step.active .label{ color:var(--text); font-weight:600; }
    .progress{ grid-column:1 / -1; height:6px; background:rgba(255,255,255,0.08); border-radius:999px; overflow:hidden; position:relative; }
    .progress > span{ position:absolute; inset:0 100% 0 0; background:linear-gradient(90deg,#4dabf7,#74c0fc); }

    /* Form */
    .row{ display:grid; grid-template-columns:1fr 1fr; gap:16px; }
    .row.onecol{ grid-template-columns:1fr; }
    @media (max-width:720px){ .row{ grid-template-columns:1fr; } }

    label{ display:block; font-weight:600; margin-bottom:6px; }
    input[type="text"], input[type="number"], select{
      width:100%; padding:12px 14px; border-radius:12px; border:1px solid rgba(255,255,255,0.12);
      background:#0e1a3d; color:var(--text); outline:none; transition:border-color .2s, box-shadow .2s;
    }
    input:focus, select:focus{ border-color:var(--focus); box-shadow:0 0 0 3px rgba(148,210,255,.25); }
    input[readonly]{ opacity:.85; }

    .hint{ font-size:12px; color:var(--muted); margin-top:6px; }

    .actions{ display:flex; flex-wrap:wrap; gap:12px; margin-top:12px; }
    .btn{ appearance:none; -webkit-appearance:none; border:0; border-radius:12px; padding:12px 16px; font-weight:700; cursor:pointer; background:#1b274d; color:var(--text); }
    .btn:hover{ filter:brightness(1.08); }
    .btn:focus{ outline:3px solid rgba(148,210,255,.35); outline-offset:2px; }
    .btn.primary{ background:linear-gradient(90deg,#4dabf7,#74c0fc); color:#081120; }
    .btn.success{ background:linear-gradient(90deg,#2f9e44,#51cf66); color:#081120; }
    .btn.warning{ background:linear-gradient(90deg,#f59f00,#fcc419); color:#081120; }
    .btn.ghost{ background:transparent; border:1px solid rgba(255,255,255,0.18); }
    .btn[disabled]{ opacity:.6; cursor:not-allowed; }

    .status{ background:#0b1633; border:1px dashed rgba(255,255,255,0.18); border-radius:12px; padding:12px; white-space:pre-wrap; color:#e5f1ff; }

    .info{
      display:grid; grid-template-columns:1fr; gap:8px; margin-top:8px; color:var(--muted); font-size:14px;
    }
    .pill{ display:inline-flex; align-items:center; gap:8px; padding:6px 10px; background:rgba(255,255,255,0.06); border:1px solid rgba(255,255,255,0.12); border-radius:999px; }
    .pill code{ color:#b8d3ff; }

    .section-title{ margin:0 0 8px; font-size:20px; }

    .sr-only{ position:absolute !important; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0; }

    .copy-wrap{ display:flex; gap:8px; }
    .copy-wrap input{ flex:1; }

    a.inline{ color:#9bd0ff; text-decoration:none; }
    a.inline:hover{ text-decoration:underline; }
  </style>

  
<!-- Favicons -->
<link rel="icon" type="image/png" sizes="32x32" href="images/favicon-32.png?v=2">
<link rel="icon" type="image/png" sizes="16x16" href="images/favicon-16.png?v=2">
<link rel="apple-touch-icon" sizes="180x180" href="images/favicon-180.png?v=2">

  
</head>
<body>
  <main class="container">
    <div class="topbar" role="navigation" aria-label="Top">
      <a class="brand" href="/" aria-label="Back to Home">
        <span class="dot" aria-hidden="true"></span>
        <span>Million Star Resort</span>
      </a>
      <div class="toplinks">
        <a href="/">Home</a>
      </div>
    </div>

    <section class="card" aria-labelledby="investHeader">
      <div class="card-header">
        <h1 id="investHeader" class="section-title">Invest in Million Star Resort</h1>
        <div class="stepper" aria-label="Checkout steps">
          <div class="step" data-step="1">
            <div class="circle" aria-hidden="true">1</div>
            <div class="label">Connect</div>
          </div>
          <div class="step" data-step="2">
            <div class="circle" aria-hidden="true">2</div>
            <div class="label">Amount & Referral</div>
          </div>
          <div class="step" data-step="3">
            <div class="circle" aria-hidden="true">3</div>
            <div class="label">Review</div>
          </div>
          <div class="step" data-step="4">
            <div class="circle" aria-hidden="true">4</div>
            <div class="label">Done</div>
          </div>
          <div class="progress" aria-hidden="true"><span id="progressFill"></span></div>
        </div>
      </div>

      <div class="card-body">
        <!-- STEP 1: Connect -->
        <section id="step1" class="step-panel" aria-labelledby="step1h">
          <h2 id="step1h" class="sr-only">Step 1 — Connect Wallet</h2>
          <div class="row onecol">
            <div>
              <label>Wallet</label>
              <div class="actions">
                <button id="btnConnect" class="btn primary">Connect Wallet</button>
                <button id="btnInstall" class="btn ghost" hidden>Install MetaMask</button>
                <button id="btnOpenWallet" class="btn ghost" hidden>Open in Wallet App</button>
              </div>
              <div class="info">
                <span class="pill">Network: <strong>Polygon</strong> (MATIC)</span>
                <span class="pill">Contract: <code id="contractShort">—</code> <button id="copyContract" class="btn ghost" style="padding:6px 10px">Copy</button></span>
                <span class="pill">Explorer: <a id="viewExplorer" class="inline" href="#" target="_blank" rel="noopener">View on Polygonscan</a></span>
              </div>
              <p class="hint">We’ll request permission in your wallet. No funds move yet.</p>
              <div class="actions">
                <button id="toStep2" class="btn" disabled>Continue</button>
              </div>
            </div>
          </div>
        </section>

        <!-- STEP 2: Amount & Referral -->
        <section id="step2" class="step-panel" aria-labelledby="step2h" hidden>
          <h2 id="step2h" class="sr-only">Step 2 — Amount & Referral</h2>
          <div class="row onecol">
            <div>
              <label for="amountMatic">Amount (MATIC)</label>
              <input id="amountMatic" type="number" min="0" step="0.0001" placeholder="e.g. 1.0" inputmode="decimal" />
              <div id="fiatHint" class="hint" aria-live="polite"></div>
            </div>
            <div>
              <label for="referralAddr">Referral Address (optional)</label>
              <input id="referralAddr" type="text" placeholder="0x… or leave blank" />
              <div class="hint">If you followed a referral link, this may be prefilled and locked.</div>
            </div>
            <div class="actions">
              <button class="btn ghost" id="back1">Back</button>
              <button class="btn primary" id="toStep3">Review</button>
            </div>
          </div>
        </section>

        <!-- STEP 3: Review -->
        <section id="step3" class="step-panel" aria-labelledby="step3h" hidden>
          <h2 id="step3h" class="sr-only">Step 3 — Review & Confirm</h2>
          <div class="row onecol">
            <div>
              <p class="hint">Please confirm the details below before sending:</p>
              <div class="info">
                <span class="pill">Amount: <strong><span id="revAmount">—</span> MATIC</strong> (<span id="revUsd">$0.00</span>)</span>
                <span class="pill">Referral: <code id="revRef">—</code></span>
                <span class="pill">To: <code id="revTo">—</code></span>
                <span class="pill">From: <code id="revFrom">—</code></span>
              </div>
              <div class="actions">
                <button class="btn ghost" id="back2">Back</button>
                <button class="btn success" id="btnInvest">Confirm & Invest</button>
              </div>
            </div>
          </div>
        </section>

        <!-- STEP 4: Done -->
        <section id="step4" class="step-panel" aria-labelledby="step4h" hidden>
          <h2 id="step4h" class="sr-only">Step 4 — Done</h2>
          <div class="row onecol">
            <div>
              <p class="hint">Your transaction has been submitted. You can follow it on the block explorer.</p>
              <div class="info">
                <span class="pill">Tx Hash: <code id="txHash">—</code> <a id="viewTx" class="inline" href="#" target="_blank" rel="noopener">View</a></span>
              </div>
              <div style="margin-top:12px">
                <label for="shareRef"><strong>Your referral link</strong></label>
                <div class="copy-wrap">
                  <input id="shareRef" type="text" readonly />
                  <button id="copyRef" class="btn">Copy</button>
                </div>
                <div class="hint">Share this link to earn referral credit: anyone who invests through it will include your address.</div>
              </div>
              <div class="actions" style="margin-top:16px">
                <a class="btn" href="/">Back to Home</a>
              </div>
            </div>
          </div>
        </section>

        <div aria-live="polite" class="status" id="statusBox">Status: Ready</div>
      </div>
    </section>
  </main>


  <script>
  (function initReferral() {
    const isAddress = v => /^0x[a-fA-F0-9]{40}$/.test(v || "");
    const refEl = document.getElementById("referralAddr");
    const statusEl = document.getElementById("statusBox");

    const qs = new URLSearchParams(location.search);
    const ref = qs.get("ref") || localStorage.getItem("mst_ref") || "";

    if (ref) {
      if (isAddress(ref)) {
        refEl.value = ref;
        refEl.readOnly = true;                // lock if came from link/storage
        refEl.setAttribute("aria-readonly","true");
        try { localStorage.setItem("mst_ref", ref); } catch {}
        statusEl.textContent = "Status: Referral locked: " + ref.slice(0,6) + "…" + ref.slice(-4);
      } else {
        statusEl.textContent = "Status: Referral parameter invalid. You can enter a different address.";
      }
    }
  })();
</script>


  
  <script>
    // ===== Config =====
    const CONTRACT_ADDRESS = "0x6715A25da511a4909dFBFbAD906Aa41F444CfD7a"; // replace if needed
    const POLYGON = {
      chainId: "0x89",
      name: "Polygon Mainnet",
      explorer: "https://polygonscan.com",
    };
    // Optional static rate for UX hint; replace with your backend/price oracle if desired
    let MATIC_USD = 0.65;

    // ===== Utilities =====
    const $ = (sel,ctx=document) => ctx.querySelector(sel);
    const $$ = (sel,ctx=document) => Array.from(ctx.querySelectorAll(sel));
    const isMobile = /Mobi|Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
    const hasProvider = () => typeof window.ethereum !== "undefined";
    const isAddress = v => /^0x[a-fA-F0-9]{40}$/.test(v || "");
    const short = (a) => a && a.startsWith("0x") ? a.slice(0,6)+"…"+a.slice(-4) : a || "—";

    const statusBox = $("#statusBox");
    const setStatus = (msg) => statusBox.textContent = `Status: ${msg}`;

    const progressFill = $("#progressFill");
    function setStep(n){
      $$(".step").forEach((el,i)=> el.classList.toggle("active", i < n));
      ["#step1","#step2","#step3","#step4"].forEach((id,i)=> $(id).hidden = (i !== (n-1)) );
      progressFill.style.right = `${100 - ((n-1)/3)*100}%`;
    }

    function copy(text){
      try { navigator.clipboard.writeText(text); setStatus("Copied to clipboard"); }
      catch { /* fallback */ }
    }

    function parseEtherToHexWei(amountStr){
      if (!amountStr) throw new Error("Invalid amount");
      const [wRaw, fRaw=""] = String(amountStr).split(".");
      const whole = wRaw === "" ? "0" : wRaw;
      const frac = (fRaw + "0".repeat(18)).slice(0,18);
      const wei = BigInt(whole) * (10n ** 18n) + BigInt(frac);
      return "0x" + wei.toString(16);
    }

    function usd(v){ return isFinite(v) ? `$${Number(v).toFixed(2)}` : "$0.00"; }

    // ===== Elements =====
    const btnConnect = $("#btnConnect");
    const btnInstall = $("#btnInstall");
    const btnOpenWallet = $("#btnOpenWallet");
    const toStep2 = $("#toStep2");
    const toStep3 = $("#toStep3");
    const back1 = $("#back1");
    const back2 = $("#back2");
    const btnInvest = $("#btnInvest");

    const amountEl = $("#amountMatic");
    const fiatHint = $("#fiatHint");
    const refEl = $("#referralAddr");

    const revAmount = $("#revAmount");
    const revUsd = $("#revUsd");
    const revRef = $("#revRef");
    const revTo = $("#revTo");
    const revFrom = $("#revFrom");

    const txHashEl = $("#txHash");
    const viewTx = $("#viewTx");

    const contractShort = $("#contractShort");
    const copyContract = $("#copyContract");
    const viewExplorer = $("#viewExplorer");

    const shareRef = $("#shareRef");
    const copyRef = $("#copyRef");

    contractShort.textContent = short(CONTRACT_ADDRESS);
    copyContract.addEventListener("click", ()=> copy(CONTRACT_ADDRESS));
    viewExplorer.href = `${POLYGON.explorer}/address/${CONTRACT_ADDRESS}`;

    // Step control
    setStep(1);

    // Prefill from URL/localStorage
    (function initFromURL(){
      const qs = new URLSearchParams(location.search);
      const amt = qs.get("amt");
      const ref = qs.get("ref") || localStorage.getItem("mst_ref") || "";

      if (amt && !isNaN(amt) && Number(amt)>0) { amountEl.value = amt; }
      if (ref) {
        if (isAddress(ref)) {
          refEl.value = ref; refEl.readOnly = true; refEl.setAttribute("aria-readonly","true");
          localStorage.setItem("mst_ref", ref);
          setStatus(`Referral locked: ${short(ref)}`);
        } else {
          setStatus("Referral parameter invalid. You can enter a different address.");
        }
      }
      updateFiat();
    })();

    // Wallet helper visibility
    (function setupHelpers(){
      if (hasProvider()) {
        btnInstall.hidden = true;
        btnOpenWallet.hidden = true;
      } else {
        if (isMobile) {
          btnOpenWallet.hidden = false;
          btnOpenWallet.addEventListener("click", (e)=>{
            e.preventDefault();
            const cleanUrl = location.href.replace(/^https?:\/\//, "");
            location.href = `https://metamask.app.link/dapp/${cleanUrl}`;
          });
        } else {
          btnInstall.hidden = false;
          btnInstall.addEventListener("click", ()=> window.open("https://metamask.io/download/","_blank","noopener"));
        }
      }
    })();

    // Amount -> USD hint
    function updateFiat(){
      const v = parseFloat(amountEl.value);
      fiatHint.textContent = (!isNaN(v) && v>0) ? `≈ ${usd(v*MATIC_USD)} USD` : "";
    }
    amountEl.addEventListener("input", updateFiat);

    // Web3 state
    let currentAccount = null;

    async function ensurePolygon(){
      if (!hasProvider()) return false;
      const ethereum = window.ethereum;
      try {
        const cid = await ethereum.request({ method:"eth_chainId" });
        if (cid.toLowerCase() !== POLYGON.chainId.toLowerCase()){
          try {
            await ethereum.request({ method:"wallet_switchEthereumChain", params:[{ chainId: POLYGON.chainId }] });
          } catch(e){
            if (e.code === 4902){
              await ethereum.request({ method:"wallet_addEthereumChain", params:[{ chainId: POLYGON.chainId, chainName: POLYGON.name, nativeCurrency:{ name:"MATIC", symbol:"MATIC", decimals:18 }, rpcUrls:["https://polygon-rpc.com"], blockExplorerUrls:[POLYGON.explorer] }] });
            } else { throw e; }
          }
        }
        return true;
      } catch(e){ setStatus(e.message || "Network switch failed"); return false; }
    }

    btnConnect.addEventListener("click", async ()=>{
      if (!hasProvider()){ setStatus("No wallet detected."); return; }
      const ethereum = window.ethereum;
      try {
        await ensurePolygon();
        const accs = await ethereum.request({ method:"eth_requestAccounts" });
        currentAccount = accs && accs[0];
        if (currentAccount){
          setStatus(`Connected: ${short(currentAccount)}`);
          toStep2.disabled = false; // allow continue
          // Prebuild referral link for success step
          shareRef.value = buildInvestUrl(currentAccount);

        }
      } catch(e){ setStatus(e.message || "Connect failed"); }
    });

    // Navigation
    toStep2.addEventListener("click", ()=> setStep(2));
    back1.addEventListener("click", ()=> setStep(1));

    toStep3.addEventListener("click", ()=>{
      const amt = parseFloat(amountEl.value);
      if (!currentAccount){ setStatus("Please connect wallet first."); return; }
      if (!amt || amt<=0){ setStatus("Enter a valid positive amount."); amountEl.focus(); return; }
      // Fill review
      revAmount.textContent = String(amt);
      revUsd.textContent = usd(amt*MATIC_USD);
      const ref = (refEl.value||"").trim();
      revRef.textContent = isAddress(ref) ? short(ref) : "—";
      revTo.textContent = short(CONTRACT_ADDRESS);
      revFrom.textContent = short(currentAccount);
      setStep(3);
    });
    back2.addEventListener("click", ()=> setStep(2));


    // Copy referral link on success
    copyRef.addEventListener("click", ()=> copy(shareRef.value));

    // React to wallet changes
    if (hasProvider()){
      const eth = window.ethereum;
      eth.on?.('accountsChanged', (accs)=>{
        currentAccount = (accs && accs[0]) || null;
        setStatus(currentAccount ? `Account: ${short(currentAccount)}` : 'No account');
        toStep2.disabled = !currentAccount;
        if (currentAccount) shareRef.value = `${location.origin}/invest?ref=${currentAccount}`;
      });
      eth.on?.('chainChanged', ()=> location.reload());
    }
  </script>

  <script>
  // Works on any page under /template01/ (GitHub Pages project)
  function projectBase() {
    const segs = location.pathname.split('/').filter(Boolean);
    return segs.length ? `/${segs[0]}/` : '/';
  }

  // If your invest page is a FOLDER with index.html, keep 'invest/'
  // If it's a single file, change to 'invest.html'
  function buildInvestUrl(ref) {
    const investPath = projectBase() + 'invest/';     // or 'invest.html'
    const u = new URL(investPath, location.origin);
    if (ref) u.searchParams.set('ref', ref);
    return u.href;
  }
</script>



  
  <script type="module">
  import {
    BrowserProvider,
    Contract,
    parseEther
  } from "https://cdn.jsdelivr.net/npm/ethers@6.13.2/dist/ethers.min.js";

  // ---- Same config as your page ----
  const CONTRACT_ADDRESS = "0x6715A25da511a4909dFBFbAD906Aa41F444CfD7a";
  const POLYGON = { chainId: "0x89", explorer: "https://polygonscan.com" };
  const ABI = [
    "function invest(address referralAddr) payable returns (uint256 tokenAmount)"
  ];

  // ---- Grab your existing DOM elements ----
  const btnInvest  = document.getElementById("btnInvest");
  const amountEl   = document.getElementById("amountMatic");
  const refEl      = document.getElementById("referralAddr");
  const statusBox  = document.getElementById("statusBox");
  const txHashEl   = document.getElementById("txHash");
  const viewTx     = document.getElementById("viewTx");

  const setStatus = (m) => statusBox.textContent = "Status: " + m;
  const isAddress = (v) => /^0x[a-fA-F0-9]{40}$/.test(v || "");

  async function ensurePolygon() {
    const ethereum = window.ethereum;
    const cid = await ethereum.request({ method: "eth_chainId" });
    if (cid.toLowerCase() === POLYGON.chainId.toLowerCase()) return true;
    try {
      await ethereum.request({
        method: "wallet_switchEthereumChain",
        params: [{ chainId: POLYGON.chainId }]
      });
      return true;
    } catch (e) {
      if (e.code === 4902) {
        await ethereum.request({
          method: "wallet_addEthereumChain",
          params: [{
            chainId: POLYGON.chainId,
            chainName: "Polygon Mainnet",
            nativeCurrency: { name: "MATIC", symbol: "MATIC", decimals: 18 },
            rpcUrls: ["https://polygon-rpc.com"],
            blockExplorerUrls: [POLYGON.explorer]
          }]
        });
        return true;
      }
      throw e;
    }
  }

  btnInvest.addEventListener("click", async () => {
    try {
      if (!window.ethereum) return setStatus("No wallet detected.");
      // Keep your 2-step: require an already-connected account
      const accounts = await window.ethereum.request({ method: "eth_accounts" });
      const currentAccount = accounts && accounts[0];
      if (!currentAccount) return setStatus("Please connect wallet first.");

      await ensurePolygon();

      const amtStr = (amountEl.value || "").trim();
      if (!amtStr || Number(amtStr) <= 0) return setStatus("Enter a valid amount.");

      let referral = (refEl.value || "").trim();
      if (!isAddress(referral)) {
        referral = "0x0000000000000000000000000000000000000000";
      }

      // Call invest(referral) with value
      const provider = new BrowserProvider(window.ethereum);
      const signer   = await provider.getSigner();
      const contract = new Contract(CONTRACT_ADDRESS, ABI, signer);

      setStatus("Preparing transaction…");
      const overrides = { value: parseEther(amtStr) };
      const gas = await contract.invest.estimateGas(referral, overrides);

      setStatus("Sending transaction… check your wallet");
      const tx = await contract.invest(referral, { ...overrides, gasLimit: gas });

      txHashEl.textContent = tx.hash.slice(0,6) + "…" + tx.hash.slice(-4);
      viewTx.href = `${POLYGON.explorer}/tx/${tx.hash}`;
      setStatus("Transaction sent! View on explorer.");
      if (typeof window.setStep === "function") window.setStep(4);
    } catch (e) {
      setStatus("Invest failed: " + (e.shortMessage || e.message || e));
    }
  });
</script>

</body>
</html>
